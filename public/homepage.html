<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Teachable Test</title>
    <link href="assets/css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
  <style>
  #sortable { list-style-type: none; margin: 0; padding: 0; width: 60%; }
  #sortable li { margin: 0 3px 3px 3px; padding: 0.4em; padding-left: 1.5em; font-size: 1.0em; height: 40px; }
  </style>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <header>
	    <h1>Teachable Test</h1>
    </header>
    <main>
	    <div class="container">
        <div class="row">
          <div class="col-md-12 thanks-alert" ></div>
        </div>
	    	<div class="row">
	    		<div class="sidebar-left col-xs-12 col-sm-4">

	    			<form id="form">
              <h4>Please Register</h4>
						  <input type="text" name="name" placeholder="username" id="input-name">
						  <input type="text" name="email" placeholder="email">
						  <input type="submit" value="Submit" id="pushSubmit">
						</form>

    			</div>
	    		<div class="main-content col-xs-12 col-sm-8">
	    			<div class="registrants">
		    			<h4>Registrants</h4>
              <div id="no-registrants">
              <p class="no-reg-text text-center">There are no registrants</p>
              </div>
              <ul id="sortable"></ul>
	    		</div>
	    	</div>
	    </div>
    </div>
    </main>
    <footer>

    </footer>
    <script src="assets/js/bootstrap.min.js"></script>
    <script>
// Window load get json, if empty toggle no registrants div
$(function() {
  $.ajax({
      type: "GET",
      url: "/",
      datatype: "json",
      //data : $("#form").serialize(),
      success: function(){
        // Reset input fields & declare ul variable for sorting
        document.getElementById("form").reset();
        var registrantData = $('#sortable');
        // Start script to grab json
        $.getJSON('/', function (data) {
          console.log(data);

          var guests = data.guests.map(function (guest) {
            return guest.name + ': ' + guest.email;
          });

          registrantData.empty();

          if (guests.length) {
            var content = '<li class="ui-state-default">' + '<span class="glyphicon glyphicon-menu-hamburger">' + '</span>' + guests.join('</li><li class="ui-state-default"><span class="glyphicon glyphicon-menu-hamburger"></span>') + '</li>';
            registrantData.append(content);
          }
          else {
            $( "#no-registrants" ).toggle(true);
          }
          // Fire refresh after initialization to allow sorting
         registrantData.sortable("refresh")
        });
      registrantData.sortable()
      },
});
});
//Submit script - post path
$('#pushSubmit').click(function(e) {
  e.preventDefault();
  var inputName = $("#input-name").val();

  $.ajax({
      type: "POST",
      url: "/",
      datatype: "json",
      data : $("#form").serialize(),
      success: function(){
        // Reset input fields & declare ul variable for sorting
        document.getElementById("form").reset();
        var registrantData = $('#sortable');

        // Toggle false no registrants div
        $( "#no-registrants" ).toggle(false);

        // Start script for bootstrap alert
        $(".thanks-alert").html('<div class="alert alert-success alert-dismissable" role="alert">' + '<button type="button" class="close" data-dismiss="alert" aria-label="Close">' + '<span aria-hidden="true">&times;</span></button>' + '<p>Thanks for registering ' + inputName + '</p></div>');
        // Start script for adding users to json
        $.getJSON('/', function (data) {

          var guests = data.guests.map(function (guest) {
            return guest.name + ': ' + guest.email;
          });

          registrantData.empty();

          if (guests.length) {
            var content = '<li class="ui-state-default">' + '<span class="glyphicon glyphicon-menu-hamburger">' + '</span>' + guests.join('</li><li class="ui-state-default"><span class="glyphicon glyphicon-menu-hamburger"></span>') + '</li>';
            registrantData.append(content);
          }
          // Fire after initialization
         registrantData.sortable("refresh")
        });
      registrantData.sortable()
      },
      error: function(){
        $("#sortable").html("No good")
      }
    });
});
    </script>
  </body>
</html>
